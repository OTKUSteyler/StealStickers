(function(d,i,S,h,l){"use strict";const{Linking:f}=h.ReactNative;let c=[];function k(e){return e?e.id&&e.format_type?u(e):e.sticker&&e.sticker.id?u(e.sticker):e.stickerItems&&Array.isArray(e.stickerItems)&&e.stickerItems.length>0?u(e.stickerItems[0]):e.sticker_items&&Array.isArray(e.sticker_items)&&e.sticker_items.length>0?u(e.sticker_items[0]):e.stickers&&Array.isArray(e.stickers)&&e.stickers.length>0?u(e.stickers[0]):null:null}function u(e){const o=e.format_type||1;let t;switch(o){case 1:t="png";break;case 2:t="apng";break;case 3:t="json";break;case 4:t="gif";break;default:t="png";break}return{id:e.id,name:e.name||"sticker",url:`https://cdn.discordapp.com/stickers/${e.id}.${t}`,format:o,extension:t}}async function y(e){try{const o=`${e.name.replace(/[^a-zA-Z0-9]/g,"_")}_${e.id}.${e.extension}`,t=i.findByProps("downloadFile",!1)||i.findByProps("saveFile",!1)||i.findByProps("downloadAsset",!1);if(t?.downloadFile){await t.downloadFile(e.url,o),l.showToast(`Downloaded ${e.name}! \u{1F4E5}`);return}if(t?.saveFile){await t.saveFile(e.url,o),l.showToast(`Saved ${e.name}! \u{1F4E5}`);return}f?(await f.openURL(e.url),l.showToast("Opened sticker URL \u{1F310}")):l.showToast("Download not available \u274C")}catch(o){console.error("[StealStickers] Download failed:",o),l.showToast(`Failed: ${o.message}`)}}function p(e,o,t=0){if(!e||t>10)return!1;if(e.props?.options&&Array.isArray(e.props.options))return console.log(`[StealStickers] Found options array at depth ${t}:`,e.props.options.map(function(r){return r.label})),e.props.options.push(o),console.log("[StealStickers] \u2705 Injected download option!"),!0;if(e.props?.children)if(Array.isArray(e.props.children)){for(const r of e.props.children)if(p(r,o,t+1))return!0}else return p(e.props.children,o,t+1);return!1}function g(){try{const e=i.findByName("sticker_detail_action_sheet",!1);if(!e){console.warn("[StealStickers] sticker_detail_action_sheet not found");return}console.log("[StealStickers] \u2705 Found sticker_detail_action_sheet");const o=S.after("type",e,function(t,r){try{const n=t[0];console.log("[StealStickers] Sheet opened! Props keys:",Object.keys(n||{}));const a=k(n)||k(n?.sticker)||k(n?.message);if(!a)return console.warn("[StealStickers] \u274C No sticker info found"),console.log("[StealStickers] Props:",JSON.stringify(n,null,2)),r;console.log("[StealStickers] \u2705 Found sticker:",a.name,`(${a.id})`);const F={label:"\u{1F4E5} Download Sticker",onPress:function(){console.log("[StealStickers] Download button pressed!"),y(a)}};if(console.log("[StealStickers] Attempting to inject option..."),console.log("[StealStickers] Return value type:",r?.type?.name||typeof r),p(r,F))return r;console.warn("[StealStickers] \u26A0\uFE0F Could not find options array in tree"),console.log("[StealStickers] Full return structure:",JSON.stringify(r,function(_,s){return _==="children"&&Array.isArray(s)?`[${s.length} children]`:typeof s=="function"?"[Function]":typeof s=="object"&&s!==null&&Object.keys(s).length>5?"[Object]":s},2))}catch(n){console.error("[StealStickers] \u274C Error in sticker detail patch:",n)}return r});c.push(o),console.log("[StealStickers] \u2705 Patched sticker_detail_action_sheet")}catch(e){console.error("[StealStickers] \u274C Failed to patch sticker detail sheet:",e)}}function w(){try{const e=i.findByProps("openStickerPickerActionSheet",!1)||i.findByProps("showStickerSheet",!1);if(!e){console.warn("[StealStickers] Sticker module not found");return}console.log("[StealStickers] Found sticker module");const o=["openStickerPickerActionSheet","showStickerSheet","default"];for(const t of o)if(typeof e[t]=="function"){const r=S.after(t,e,function(n,a){return console.log(`[StealStickers] ${t} called with args:`,n),a});c.push(r),console.log(`[StealStickers] Patched ${t}`)}}catch(e){console.error("[StealStickers] Failed to patch by props:",e)}}var m={onLoad:function(){try{g(),w(),c.length===0?console.warn("[StealStickers] No patches applied. Tap a sticker to trigger the ActionSheet load, then re-enable the plugin."):console.log(`[StealStickers] Enabled with ${c.length} patches \u{1F4E5}`)}catch(e){console.error("[StealStickers] Failed to load:",e)}},onUnload:function(){const e=[...c];c=[];for(const o of e)try{o?.()}catch{}console.log("[StealStickers] Disabled")}};return d.default=m,Object.defineProperty(d,"__esModule",{value:!0}),d})({},vendetta.metro,vendetta.patcher,vendetta.metro.common,vendetta.ui.toasts);
