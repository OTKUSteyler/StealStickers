(function(u,i,p,y,a){"use strict";const{Platform:m,Linking:f}=y.ReactNative;let c=[];function h(e){if(!e)return null;if(e.sticker_items&&Array.isArray(e.sticker_items)&&e.sticker_items.length>0){const n=e.sticker_items[0];return S(n)}if(e.stickers&&Array.isArray(e.stickers)&&e.stickers.length>0){const n=e.stickers[0];return S(n)}return null}function S(e){const n=e.format_type||1,r=n===3?"json":n===2?"apng":"png";return{id:e.id,name:e.name||"sticker",url:`https://cdn.discordapp.com/stickers/${e.id}.${r}`,format:n,extension:r}}async function k(e){try{const n=`${e.name.replace(/[^a-zA-Z0-9]/g,"_")}_${e.id}.${e.extension}`,r=i.findByProps("downloadFile",!1)||i.findByProps("saveFile",!1)||i.findByProps("downloadAsset",!1);if(r?.downloadFile){await r.downloadFile(e.url,n),a.showToast(`Downloaded ${e.name}! \u{1F4E5}`,"success");return}if(r?.saveFile){await r.saveFile(e.url,n),a.showToast(`Saved ${e.name}! \u{1F4E5}`,"success");return}f?(await f.openURL(e.url),a.showToast("Opened sticker URL \u{1F310}","info")):a.showToast("Download not available \u274C","error")}catch(n){console.error("[StealStickers] Download failed:",n),a.showToast(`Failed: ${n.message}`,"error")}}function g(){try{const e=i.findByName("MessageLongPressActionSheet",!1);if(!e){console.warn("[StealStickers] MessageLongPressActionSheet not found");return}const n=p.after("type",e,function(r,t){try{const s=r[0]?.message;if(!s)return t;const l=h(s);if(!l)return t;const o={key:"steal-sticker",icon:"\u{1F4E5}",label:"Download Sticker",onPress:function(){k(l)}};if(t?.props){if(Array.isArray(t.props.options))return t.props.options.push(o),t;if(t.props.children)if(Array.isArray(t.props.children)){for(const d of t.props.children)if(d?.props?.options&&Array.isArray(d.props.options))return d.props.options.push(o),t;t.props.children.push(o)}else t.props.children=[t.props.children,o];else t.props.children=o}}catch(s){console.error("[StealStickers] Error in ActionSheet patch:",s)}return t});c.push(n),console.log("[StealStickers] Patched MessageLongPressActionSheet")}catch(e){console.error("[StealStickers] Failed to patch ActionSheet:",e)}}function A(){try{const e=i.findByProps("getMessageActions",!1)||i.findByProps("buildMessageActions",!1);if(!e){console.warn("[StealStickers] Actions module not found");return}if(typeof(e.getMessageActions||e.buildMessageActions||e.default)!="function"){console.warn("[StealStickers] No patchable function in actions module");return}const n=p.after("getMessageActions",e,function(r,t){try{const s=r[0],l=h(s);if(!l)return t;const o={key:"steal-sticker",label:"\u{1F4E5} Download Sticker",onPress:function(){return k(l)}};Array.isArray(t)&&t.push(o)}catch(s){console.error("[StealStickers] Error in action builder patch:",s)}return t});c.push(n),console.log("[StealStickers] Patched action builder")}catch(e){console.error("[StealStickers] Failed to patch action builder:",e)}}var w={onLoad:function(){try{g(),A(),c.length===0?console.warn("[StealStickers] No patches applied. The plugin may not work until Discord loads the ActionSheet."):console.log(`[StealStickers] Enabled with ${c.length} patches \u{1F4E5}`)}catch(e){console.error("[StealStickers] Failed to load:",e)}},onUnload:function(){const e=[...c];c=[];for(const n of e)try{n?.()}catch{}console.log("[StealStickers] Disabled")}};return u.default=w,Object.defineProperty(u,"__esModule",{value:!0}),u})({},vendetta.metro,vendetta.patcher,vendetta.metro.common,vendetta.ui.toasts);
