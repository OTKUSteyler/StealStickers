(function(u,i,f,y,a){"use strict";const{Platform:m,Linking:h}=y.ReactNative;let c=[];function k(e){if(!e)return null;if(e.stickerItems&&Array.isArray(e.stickerItems)&&e.stickerItems.length>0){const t=e.stickerItems[0];return d(t)}if(e.sticker_items&&Array.isArray(e.sticker_items)&&e.sticker_items.length>0){const t=e.sticker_items[0];return d(t)}if(e.stickers&&Array.isArray(e.stickers)&&e.stickers.length>0){const t=e.stickers[0];return d(t)}return null}function d(e){const t=e.format_type||1;let s;switch(t){case 1:s="png";break;case 2:s="apng";break;case 3:s="json";break;case 4:s="gif";break;default:s="png";break}return{id:e.id,name:e.name||"sticker",url:`https://cdn.discordapp.com/stickers/${e.id}.${s}`,format:t,extension:s}}async function S(e){try{const t=`${e.name.replace(/[^a-zA-Z0-9]/g,"_")}_${e.id}.${e.extension}`,s=i.findByProps("downloadFile",!1)||i.findByProps("saveFile",!1)||i.findByProps("downloadAsset",!1);if(s?.downloadFile){await s.downloadFile(e.url,t),a.showToast(`Downloaded ${e.name}! \u{1F4E5}`,"success");return}if(s?.saveFile){await s.saveFile(e.url,t),a.showToast(`Saved ${e.name}! \u{1F4E5}`,"success");return}h?(await h.openURL(e.url),a.showToast("Opened sticker URL \u{1F310}","info")):a.showToast("Download not available \u274C","error")}catch(t){console.error("[StealStickers] Download failed:",t),a.showToast(`Failed: ${t.message}`,"error")}}function g(){try{const e=i.findByName("MessageLongPressActionSheet",!1);if(!e){console.warn("[StealStickers] MessageLongPressActionSheet not found");return}const t=f.after("type",e,function(s,o){try{const r=s[0]?.message;if(!r)return o;const l=k(r);if(!l)return o;const n={key:"steal-sticker",icon:"\u{1F4E5}",label:"Download Sticker",onPress:function(){S(l)}};if(o?.props){if(Array.isArray(o.props.options))return o.props.options.push(n),o;if(o.props.children)if(Array.isArray(o.props.children)){for(const p of o.props.children)if(p?.props?.options&&Array.isArray(p.props.options))return p.props.options.push(n),o;o.props.children.push(n)}else o.props.children=[o.props.children,n];else o.props.children=n}}catch(r){console.error("[StealStickers] Error in ActionSheet patch:",r)}return o});c.push(t),console.log("[StealStickers] Patched MessageLongPressActionSheet")}catch(e){console.error("[StealStickers] Failed to patch ActionSheet:",e)}}function A(){try{const e=i.findByProps("getMessageActions",!1)||i.findByProps("buildMessageActions",!1);if(!e){console.warn("[StealStickers] Actions module not found");return}if(typeof(e.getMessageActions||e.buildMessageActions||e.default)!="function"){console.warn("[StealStickers] No patchable function in actions module");return}const t=f.after("getMessageActions",e,function(s,o){try{const r=s[0],l=k(r);if(!l)return o;const n={key:"steal-sticker",label:"\u{1F4E5} Download Sticker",onPress:function(){return S(l)}};Array.isArray(o)&&o.push(n)}catch(r){console.error("[StealStickers] Error in action builder patch:",r)}return o});c.push(t),console.log("[StealStickers] Patched action builder")}catch(e){console.error("[StealStickers] Failed to patch action builder:",e)}}var w={onLoad:function(){try{g(),A(),c.length===0?console.warn("[StealStickers] No patches applied. The plugin may not work until Discord loads the ActionSheet."):console.log(`[StealStickers] Enabled with ${c.length} patches \u{1F4E5}`)}catch(e){console.error("[StealStickers] Failed to load:",e)}},onUnload:function(){const e=[...c];c=[];for(const t of e)try{t?.()}catch{}console.log("[StealStickers] Disabled")}};return u.default=w,Object.defineProperty(u,"__esModule",{value:!0}),u})({},vendetta.metro,vendetta.patcher,vendetta.metro.common,vendetta.ui.toasts);
