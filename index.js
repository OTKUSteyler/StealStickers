(function(p,i,h,S,a){"use strict";const{Linking:f}=S.ReactNative;let n=[];function k(e){return e?e.id&&e.format_type?l(e):e.sticker&&e.sticker.id?l(e.sticker):e.stickerItems&&Array.isArray(e.stickerItems)&&e.stickerItems.length>0?l(e.stickerItems[0]):e.sticker_items&&Array.isArray(e.sticker_items)&&e.sticker_items.length>0?l(e.sticker_items[0]):e.stickers&&Array.isArray(e.stickers)&&e.stickers.length>0?l(e.stickers[0]):null:null}function l(e){const r=e.format_type||1;let t;switch(r){case 1:t="png";break;case 2:t="apng";break;case 3:t="json";break;case 4:t="gif";break;default:t="png";break}return{id:e.id,name:e.name||"sticker",url:`https://cdn.discordapp.com/stickers/${e.id}.${t}`,format:r,extension:t}}async function y(e){try{const r=`${e.name.replace(/[^a-zA-Z0-9]/g,"_")}_${e.id}.${e.extension}`,t=i.findByProps("downloadFile",!1)||i.findByProps("saveFile",!1)||i.findByProps("downloadAsset",!1);if(t?.downloadFile){await t.downloadFile(e.url,r),a.showToast(`Downloaded ${e.name}! \u{1F4E5}`);return}if(t?.saveFile){await t.saveFile(e.url,r),a.showToast(`Saved ${e.name}! \u{1F4E5}`);return}f?(await f.openURL(e.url),a.showToast("Opened sticker URL \u{1F310}")):a.showToast("Download not available \u274C")}catch(r){console.error("[StealStickers] Download failed:",r),a.showToast(`Failed: ${r.message}`)}}function g(){try{const e=i.findByName("sticker_detail_action_sheet",!1);if(!e){console.warn("[StealStickers] sticker_detail_action_sheet not found");return}console.log("[StealStickers] Found sticker_detail_action_sheet");const r=h.after("type",e,function(t,o){try{const s=t[0],c=k(s)||k(s?.sticker)||k(s?.message);if(!c)return console.warn("[StealStickers] No sticker info found in props:",Object.keys(s||{})),o;console.log("[StealStickers] Found sticker:",c.name,c.id);const d={label:"\u{1F4E5} Download Sticker",onPress:function(){y(c)}};if(o?.props){if(Array.isArray(o.props.options))return o.props.options.push(d),o;if(o.props.children)if(Array.isArray(o.props.children)){for(const u of o.props.children)if(u?.props?.options&&Array.isArray(u.props.options))return u.props.options.push(d),o;o.props.children.push(d)}else o.props.children=[o.props.children,d];else o.props.children=d}}catch(s){console.error("[StealStickers] Error in sticker detail patch:",s)}return o});n.push(r),console.log("[StealStickers] Patched sticker_detail_action_sheet")}catch(e){console.error("[StealStickers] Failed to patch sticker detail sheet:",e)}}function w(){try{const e=i.findByProps("openStickerPickerActionSheet",!1)||i.findByProps("showStickerSheet",!1);if(!e){console.warn("[StealStickers] Sticker module not found");return}console.log("[StealStickers] Found sticker module");const r=["openStickerPickerActionSheet","showStickerSheet","default"];for(const t of r)if(typeof e[t]=="function"){const o=h.after(t,e,function(s,c){return console.log(`[StealStickers] ${t} called with args:`,s),c});n.push(o),console.log(`[StealStickers] Patched ${t}`)}}catch(e){console.error("[StealStickers] Failed to patch by props:",e)}}var m={onLoad:function(){try{g(),w(),n.length===0?console.warn("[StealStickers] No patches applied. Tap a sticker to trigger the ActionSheet load, then re-enable the plugin."):console.log(`[StealStickers] Enabled with ${n.length} patches \u{1F4E5}`)}catch(e){console.error("[StealStickers] Failed to load:",e)}},onUnload:function(){const e=[...n];n=[];for(const r of e)try{r?.()}catch{}console.log("[StealStickers] Disabled")}};return p.default=m,Object.defineProperty(p,"__esModule",{value:!0}),p})({},vendetta.metro,vendetta.patcher,vendetta.metro.common,vendetta.ui.toasts);
